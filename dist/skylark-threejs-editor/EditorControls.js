/**
 * skylark-threejs-editor - A version of threejs-editor that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-editor/
 * @license MIT
 */
define(["skylark-threejs"],function(e){"use strict";var t=function(t,o){this.enabled=!0,this.center=new e.Vector3,this.panSpeed=.002,this.zoomSpeed=.1,this.rotationSpeed=.005;var n=this,i=new e.Vector3,a=new e.Vector3,s=new e.Box3,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},c=r.NONE,d=this.center,u=new e.Matrix3,p=new e.Vector2,v=new e.Vector2,l=new e.Spherical,h=new e.Sphere,m={type:"change"};function w(e){!1!==n.enabled&&(0===e.button?c=r.ROTATE:1===e.button?c=r.ZOOM:2===e.button&&(c=r.PAN),v.set(e.clientX,e.clientY),o.addEventListener("mousemove",E,!1),o.addEventListener("mouseup",x,!1),o.addEventListener("mouseout",x,!1),o.addEventListener("dblclick",x,!1))}function E(e){if(!1!==n.enabled){p.set(e.clientX,e.clientY);var t=p.x-v.x,o=p.y-v.y;c===r.ROTATE?n.rotate(a.set(-t,-o,0)):c===r.ZOOM?n.zoom(a.set(0,0,o)):c===r.PAN&&n.pan(a.set(-t,o,0)),v.set(e.clientX,e.clientY)}}function x(){o.removeEventListener("mousemove",E,!1),o.removeEventListener("mouseup",x,!1),o.removeEventListener("mouseout",x,!1),o.removeEventListener("dblclick",x,!1),c=r.NONE}function g(e){e.preventDefault(),n.zoom(a.set(0,0,e.deltaY>0?1:-1))}function f(e){e.preventDefault()}this.focus=function(e){var o;s.setFromObject(e),!1===s.isEmpty()?(s.getCenter(d),o=s.getBoundingSphere(h).radius):(d.setFromMatrixPosition(e.matrixWorld),o=.1),a.set(0,0,1),a.applyQuaternion(t.quaternion),a.multiplyScalar(4*o),t.position.copy(d).add(a),n.dispatchEvent(m)},this.pan=function(e){var o=t.position.distanceTo(d);e.multiplyScalar(o*n.panSpeed),e.applyMatrix3(u.getNormalMatrix(t.matrix)),t.position.add(e),d.add(e),n.dispatchEvent(m)},this.zoom=function(e){var o=t.position.distanceTo(d);e.multiplyScalar(o*n.zoomSpeed),e.length()>o||(e.applyMatrix3(u.getNormalMatrix(t.matrix)),t.position.add(e),n.dispatchEvent(m))},this.rotate=function(e){i.copy(t.position).sub(d),l.setFromVector3(i),l.theta+=e.x*n.rotationSpeed,l.phi+=e.y*n.rotationSpeed,l.makeSafe(),i.setFromSpherical(l),t.position.copy(d).add(i),t.lookAt(d),n.dispatchEvent(m)},this.dispose=function(){o.removeEventListener("contextmenu",f,!1),o.removeEventListener("mousedown",w,!1),o.removeEventListener("wheel",g,!1),o.removeEventListener("mousemove",E,!1),o.removeEventListener("mouseup",x,!1),o.removeEventListener("mouseout",x,!1),o.removeEventListener("dblclick",x,!1),o.removeEventListener("touchstart",b,!1),o.removeEventListener("touchmove",O,!1)},o.addEventListener("contextmenu",f,!1),o.addEventListener("mousedown",w,!1),o.addEventListener("wheel",g,!1);var S=[new e.Vector3,new e.Vector3,new e.Vector3],y=[new e.Vector3,new e.Vector3,new e.Vector3],L=null;function b(e){if(!1!==n.enabled){switch(e.touches.length){case 1:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio);break;case 2:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),L=S[0].distanceTo(S[1])}y[0].copy(S[0]),y[1].copy(S[1])}}function O(e){if(!1!==n.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),n.rotate(S[0].sub(s(S[0],y)).multiplyScalar(-1));break;case 2:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var t=S[0].distanceTo(S[1]);n.zoom(a.set(0,0,L-t)),L=t;var o=S[0].clone().sub(s(S[0],y)),i=S[1].clone().sub(s(S[1],y));o.x=-o.x,i.x=-i.x,n.pan(o.add(i))}y[0].copy(S[0]),y[1].copy(S[1])}function s(e,t){var o=t[0];for(var n in t)o.distanceTo(e)>t[n].distanceTo(e)&&(o=t[n]);return o}}o.addEventListener("touchstart",b,!1),o.addEventListener("touchmove",O,!1)};return(t.prototype=Object.create(e.EventDispatcher.prototype)).constructor=t,t});
//# sourceMappingURL=sourcemaps/EditorControls.js.map
