/**
 * skylark-threejs-editor - A version of threejs-editor that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-editor/
 * @license MIT
 */
define(["./commands/Commands"],function(i){"use strict";var s=function(i){this.editor=i,this.undos=[],this.redos=[],this.lastCmdTime=new Date,this.idCounter=0,this.historyDisabled=!1,this.config=i.config;var s=this;this.editor.signals.startPlayer.add(function(){s.historyDisabled=!0}),this.editor.signals.stopPlayer.add(function(){s.historyDisabled=!1})};return s.prototype={execute:function(i,s){var t=this.undos[this.undos.length-1],e=(new Date).getTime()-this.lastCmdTime.getTime(),o=t&&t.updatable&&i.updatable&&t.object===i.object&&t.type===i.type&&t.script===i.script&&t.attributeName===i.attributeName;o&&"SetScriptValueCommand"===i.type?(t.update(i),i=t):o&&e<500?(t.update(i),i=t):(this.undos.push(i),i.id=++this.idCounter),i.name=void 0!==s?s:i.name,i.execute(),i.inMemory=!0,this.config.getKey("settings/history")&&(i.json=i.toJSON()),this.lastCmdTime=new Date,this.redos=[],this.editor.signals.historyChanged.dispatch(i)},undo:function(){if(!this.historyDisabled){var i=void 0;return this.undos.length>0&&!1===(i=this.undos.pop()).inMemory&&i.fromJSON(i.json),void 0!==i&&(i.undo(),this.redos.push(i),this.editor.signals.historyChanged.dispatch(i)),i}alert("Undo/Redo disabled while scene is playing.")},redo:function(){if(!this.historyDisabled){var i=void 0;return this.redos.length>0&&!1===(i=this.redos.pop()).inMemory&&i.fromJSON(i.json),void 0!==i&&(i.execute(),this.undos.push(i),this.editor.signals.historyChanged.dispatch(i)),i}alert("Undo/Redo disabled while scene is playing.")},toJSON:function(){var i={undos:[],redos:[]};if(!this.config.getKey("settings/history"))return i;for(var s=0;s<this.undos.length;s++)this.undos[s].hasOwnProperty("json")&&i.undos.push(this.undos[s].json);for(s=0;s<this.redos.length;s++)this.redos[s].hasOwnProperty("json")&&i.redos.push(this.redos[s].json);return i},fromJSON:function(s){if(void 0!==s){for(var t=0;t<s.undos.length;t++){var e=s.undos[t];(o=new i[e.type](this.editor)).json=e,o.id=e.id,o.name=e.name,this.undos.push(o),this.idCounter=e.id>this.idCounter?e.id:this.idCounter}for(t=0;t<s.redos.length;t++){var o;e=s.redos[t];(o=new i[e.type](this.editor)).json=e,o.id=e.id,o.name=e.name,this.redos.push(o),this.idCounter=e.id>this.idCounter?e.id:this.idCounter}this.editor.signals.historyChanged.dispatch(this.undos[this.undos.length-1])}},clear:function(){this.undos=[],this.redos=[],this.idCounter=0,this.editor.signals.historyChanged.dispatch()},goToState:function(i){if(this.historyDisabled)alert("Undo/Redo disabled while scene is playing.");else{this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;var s=this.undos.length>0?this.undos[this.undos.length-1]:void 0;if(void 0===s||i>s.id)for(s=this.redo();void 0!==s&&i>s.id;)s=this.redo();else for(;void 0!==(s=this.undos[this.undos.length-1])&&i!==s.id;)this.undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch(),this.editor.signals.historyChanged.dispatch(s)}},enableSerialization:function(i){this.goToState(-1),this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;for(var s=this.redo();void 0!==s;)s.hasOwnProperty("json")||(s.json=s.toJSON()),s=this.redo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.goToState(i)}},s});
//# sourceMappingURL=sourcemaps/History.js.map
