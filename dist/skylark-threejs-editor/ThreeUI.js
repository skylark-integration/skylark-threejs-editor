/**
 * skylark-threejs-editor - A version of threejs-editor that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-editor/
 * @license MIT
 */
define(["skylark-mrdoobui","skylark-threejs","skylark-threejs-ex/loaders/RGBELoader","skylark-threejs-ex/loaders/TGALoader","./commands/MoveObjectCommand"],function(t,e,n,i,o){const{UIElement:a,UISpan:s,UIDiv:r,UIRow:h,UIButton:l,UICheckbox:d,UIText:c,UINumber:u}=t;var p=function(t){a.call(this);var o=this,s=document.createElement("span"),r=document.createElement("form"),h=document.createElement("input");h.type="file",h.addEventListener("change",function(t){d(t.target.files[0])}),r.appendChild(h);var l=document.createElement("canvas");function d(a){if(a.type.match("image.*")){var s=new FileReader;"image/targa"===a.type?(s.addEventListener("load",function(n){var s=(new i).parse(n.target.result),r=new e.CanvasTexture(s,t);r.sourceFile=a.name,o.setValue(r),o.onChangeCallback&&o.onChangeCallback(r)},!1),s.readAsArrayBuffer(a)):(s.addEventListener("load",function(n){var i=document.createElement("img");i.addEventListener("load",function(){var n=new e.Texture(this,t);n.sourceFile=a.name,n.format="image/jpeg"===a.type?e.RGBFormat:e.RGBAFormat,n.needsUpdate=!0,o.setValue(n),o.onChangeCallback&&o.onChangeCallback(n)},!1),i.src=n.target.result},!1),s.readAsDataURL(a))}else{(s=new FileReader).addEventListener("load",function(t){"hdr"===a.name.split(".").pop()&&(new n).setDataType(e.UnsignedByteType).load(t.target.result,function(t){t.sourceFile=a.name,t.isHDRTexture=!0,o.setValue(t),o.onChangeCallback&&o.onChangeCallback(t)})}),s.readAsDataURL(a)}r.reset()}return l.width=32,l.height=16,l.style.cursor="pointer",l.style.marginRight="5px",l.style.border="1px solid #888",l.addEventListener("click",function(){h.click()},!1),l.addEventListener("drop",function(){event.preventDefault(),event.stopPropagation(),d(event.dataTransfer.files[0])},!1),s.appendChild(l),this.dom=s,this.texture=null,this.onChangeCallback=null,this};(p.prototype=Object.create(a.prototype)).constructor=p,p.prototype.getValue=function(){return this.texture},p.prototype.setValue=function(t){var n=this.dom.children[0],i=n.getContext("2d");if(null!==t){var o=t.image;if(void 0!==o&&o.width>0){n.title=t.sourceFile;var a=n.width/o.width;if(void 0===o.data)i.drawImage(o,0,0,o.width*a,o.height*a);else{var s=function(t){void 0===x&&(x=new e.WebGLRenderer({canvas:new OffscreenCanvas(1,1)}));var n=t.image;x.setSize(n.width,n.height,!1),x.toneMapping=e.ReinhardToneMapping,x.toneMappingExposure=2,x.outputEncoding=e.sRGBEncoding;var i=new e.Scene,o=new e.OrthographicCamera(-1,1,1,-1,0,1),a=new e.MeshBasicMaterial({map:t}),s=new e.PlaneBufferGeometry(2,2),r=new e.Mesh(s,a);return i.add(r),x.render(i,o),x.domElement}(t);i.drawImage(s,0,0,o.width*a,o.height*a)}}else n.title=t.sourceFile+" (error)",i.clearRect(0,0,n.width,n.height)}else n.title="empty",null!==i&&i.clearRect(0,0,n.width,n.height);this.texture=t},p.prototype.setEncoding=function(t){var e=this.getValue();return null!==e&&(e.encoding=t),this},p.prototype.onChange=function(t){return this.onChangeCallback=t,this};var g=function(){a.call(this);var t=new r;this.cubeTexture=null,this.onChangeCallback=null,this.dom=t.dom,this.textures=[];var n=this,i=new h,o=new h;i.add(new c("P:").setWidth("35px")),o.add(new c("N:").setWidth("35px"));var s=(new p).onChange(f),l=(new p).onChange(f),d=(new p).onChange(f),u=(new p).onChange(f),g=(new p).onChange(f),v=(new p).onChange(f);function f(){for(var t=[],i=0;i<n.textures.length;i++){var o=n.textures[i].getValue();null!==o&&t.push(o.isHDRTexture?o:o.image)}if(6===t.length){var a=new e.CubeTexture(t);a.needsUpdate=!0,t[0].isHDRTexture&&(a.isHDRTexture=!0),n.cubeTexture=a,n.onChangeCallback&&n.onChangeCallback(a)}}this.textures.push(s,l,d,u,g,v),i.add(s),i.add(d),i.add(g),o.add(l),o.add(u),o.add(v),t.add(i,o)};(g.prototype=Object.create(a.prototype)).constructor=g,g.prototype.setEncoding=function(t){var e=this.getValue();return null!==e&&(e.encoding=t),this},g.prototype.getValue=function(){return this.cubeTexture},g.prototype.setValue=function(t){if(this.cubeTexture=t,null!==t){var n=t.image;if(!0===Array.isArray(n)&&6===n.length)for(var i=0;i<n.length;i++){var o=n[i],a=new e.Texture(o);this.textures[i].setValue(a)}}else{var s=this.textures;for(i=0;i<s.length;i++)s[i].setValue(null)}return this},g.prototype.onChange=function(t){return this.onChangeCallback=t,this};var v=function(t){a.call(this);var e=this,n=document.createElement("div");return n.className="Outliner",n.tabIndex=0,this.scene=t.scene,n.addEventListener("keydown",function(t){switch(t.keyCode){case 38:case 40:t.preventDefault(),t.stopPropagation()}},!1),n.addEventListener("keyup",function(t){switch(t.keyCode){case 38:e.selectIndex(e.selectedIndex-1);break;case 40:e.selectIndex(e.selectedIndex+1)}},!1),this.dom=n,this.editor=t,this.options=[],this.selectedIndex=-1,this.selectedValue=null,this};(v.prototype=Object.create(a.prototype)).constructor=v,v.prototype.selectIndex=function(t){if(t>=0&&t<this.options.length){this.setValue(this.options[t].value);var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!0),this.dom.dispatchEvent(e)}},v.prototype.setOptions=function(t){for(var e,n=this;n.dom.children.length>0;)n.dom.removeChild(n.dom.firstChild);function i(){n.setValue(this.value);var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),n.dom.dispatchEvent(t)}function a(){e=this}function s(t){t.dataTransfer.setData("text","foo")}function r(t){if(this!==e){var n=t.offsetY/this.clientHeight;this.className=n<.25?"option dragTop":n>.75?"option dragBottom":"option drag"}}function h(){this!==e&&(this.className="option")}function l(t){if(this!==e){this.className="option";var i=n.scene,o=i.getObjectById(e.value),a=t.offsetY/this.clientHeight;if(a<.25)d(o,(s=i.getObjectById(this.value)).parent,s);else if(a>.75){var s,r;null!==this.nextSibling?r=(s=i.getObjectById(this.nextSibling.value)).parent:(s=null,r=i.getObjectById(this.value).parent),d(o,r,s)}else{d(o,i.getObjectById(this.value))}}}function d(t,e,i){null===i&&(i=void 0);var a=!1;if(t.traverse(function(t){t===e&&(a=!0)}),!a){var s=n.editor;s.execute(new o(s,t,e,i));var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!0),n.dom.dispatchEvent(r)}}n.options=[];for(var c=0;c<t.length;c++){var u=t[c];u.className="option",n.dom.appendChild(u),n.options.push(u),u.addEventListener("click",i,!1),!0===u.draggable&&(u.addEventListener("drag",a,!1),u.addEventListener("dragstart",s,!1),u.addEventListener("dragover",r,!1),u.addEventListener("dragleave",h,!1),u.addEventListener("drop",l,!1))}return n},v.prototype.getValue=function(){return this.selectedValue},v.prototype.setValue=function(t){for(var e=0;e<this.options.length;e++){var n=this.options[e];if(n.value===t){n.classList.add("active");var i=n.offsetTop-this.dom.offsetTop,o=i+n.offsetHeight-this.dom.offsetHeight;this.dom.scrollTop>i?this.dom.scrollTop=i:this.dom.scrollTop<o&&(this.dom.scrollTop=o),this.selectedIndex=e}else n.classList.remove("active")}return this.selectedValue=t,this};var f=function(t){a.call(this);var e=(new s).setDisplay("inline-block");this.pointsList=new r,e.add(this.pointsList);var n=new h;e.add(n);var i=new l("+").onClick(t);return n.add(i),this.update=function(){null!==this.onChangeCallback&&this.onChangeCallback()}.bind(this),this.dom=e.dom,this.pointsUI=[],this.lastPointIdx=0,this.onChangeCallback=null,this};(f.prototype=Object.create(a.prototype)).constructor=f,f.prototype.onChange=function(t){return this.onChangeCallback=t,this},f.prototype.clear=function(){for(var t=0;t<this.pointsUI.length;++t)this.pointsUI[t]&&this.deletePointRow(t,!0);this.lastPointIdx=0},f.prototype.deletePointRow=function(t,e){this.pointsUI[t]&&(this.pointsList.remove(this.pointsUI[t].row),this.pointsUI[t]=null,!0!==e&&this.update())};var w=function(){return f.call(this,w.addRow.bind(this)),this};w.prototype=Object.create(f.prototype),w.prototype.constructor=w,w.addRow=function(){if(0===this.pointsUI.length)this.pointsList.add(this.createPointRow(0,0));else{var t=this.pointsUI[this.pointsUI.length-1];this.pointsList.add(this.createPointRow(t.x.getValue(),t.y.getValue()))}this.update()},w.prototype.getValue=function(){for(var t=[],n=0,i=0;i<this.pointsUI.length;i++){var o=this.pointsUI[i];o&&(t.push(new e.Vector2(o.x.getValue(),o.y.getValue())),++n,o.lbl.setValue(n))}return t},w.prototype.setValue=function(t){this.clear();for(var e=0;e<t.length;e++){var n=t[e];this.pointsList.add(this.createPointRow(n.x,n.y))}return this.update(),this},w.prototype.createPointRow=function(t,e){var n=new r,i=new c(this.lastPointIdx+1).setWidth("20px"),o=new u(t).setWidth("30px").onChange(this.update),a=new u(e).setWidth("30px").onChange(this.update),s=this.lastPointIdx,h=this,d=new l("-").onClick(function(){h.isEditing||h.deletePointRow(s)});return this.pointsUI.push({row:n,lbl:i,x:o,y:a}),++this.lastPointIdx,n.add(i,o,a,d),n};var m=function(){return f.call(this,m.addRow.bind(this)),this};m.prototype=Object.create(f.prototype),m.prototype.constructor=m,m.addRow=function(){if(0===this.pointsUI.length)this.pointsList.add(this.createPointRow(0,0,0));else{var t=this.pointsUI[this.pointsUI.length-1];this.pointsList.add(this.createPointRow(t.x.getValue(),t.y.getValue(),t.z.getValue()))}this.update()},m.prototype.getValue=function(){for(var t=[],n=0,i=0;i<this.pointsUI.length;i++){var o=this.pointsUI[i];o&&(t.push(new e.Vector3(o.x.getValue(),o.y.getValue(),o.z.getValue())),++n,o.lbl.setValue(n))}return t},m.prototype.setValue=function(t){this.clear();for(var e=0;e<t.length;e++){var n=t[e];this.pointsList.add(this.createPointRow(n.x,n.y,n.z))}return this.update(),this},m.prototype.createPointRow=function(t,e,n){var i=new r,o=new c(this.lastPointIdx+1).setWidth("20px"),a=new u(t).setWidth("30px").onChange(this.update),s=new u(e).setWidth("30px").onChange(this.update),h=new u(n).setWidth("30px").onChange(this.update),d=this.lastPointIdx,p=this,g=new l("-").onClick(function(){p.isEditing||p.deletePointRow(d)});return this.pointsUI.push({row:i,lbl:o,x:a,y:s,z:h}),++this.lastPointIdx,i.add(o,a,s,h,g),i};var x,y=function(t,e){s.call(this),this.setMarginRight("10px"),this.checkbox=new d(t),this.text=new c(e).setMarginLeft("3px"),this.add(this.checkbox),this.add(this.text)};return(y.prototype=Object.create(s.prototype)).constructor=y,y.prototype.getValue=function(){return this.checkbox.getValue()},y.prototype.setValue=function(t){return this.checkbox.setValue(t)},{UITexture:p,UICubeTexture:g,UIOutliner:v,UIPoints:f,UIPoints2:w,UIPoints3:m,UIBoolean:y}});
//# sourceMappingURL=sourcemaps/ThreeUI.js.map
