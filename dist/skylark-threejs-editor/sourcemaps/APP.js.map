{"version":3,"sources":["APP.js"],"names":["define","THREE","Player","renderer","WebGLRenderer","antialias","setPixelRatio","window","devicePixelRatio","outputEncoding","sRGBEncoding","camera","scene","time","prevTime","loader","ObjectLoader","vrButton","VRButton","createButton","events","dom","document","createElement","dispatch","array","event","i","l","length","animate","performance","now","update","delta","e","console","error","message","stack","render","onDocumentKeyDown","keydown","onDocumentKeyUp","keyup","onDocumentMouseDown","mousedown","onDocumentMouseUp","mouseup","onDocumentMouseMove","mousemove","onDocumentTouchStart","touchstart","onDocumentTouchEnd","touchend","onDocumentTouchMove","touchmove","appendChild","domElement","this","width","height","load","json","project","shadowMap","enabled","shadows","xr","vr","setScene","parse","setCamera","init","start","stop","scriptWrapParams","scriptWrapResultObj","eventKey","scriptWrapResult","JSON","stringify","replace","uuid","scripts","object","getObjectByProperty","undefined","script","functions","Function","source","bind","name","push","warn","arguments","value","aspect","updateProjectionMatrix","setSize","play","append","addEventListener","setAnimationLoop","remove","removeEventListener","dispose"],"mappings":"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","file":"../APP.js","sourcesContent":["define([\r\n\t\"skylark-threejs\"\r\n],function(THREE){\r\n\r\n\t/**\r\n\t * @author mrdoob / http://mrdoob.com/\r\n\t */\r\n\r\n\tvar APP = {\r\n\r\n\t\tPlayer: function () {\r\n\r\n\t\t\tvar renderer = new THREE.WebGLRenderer( { antialias: true } );\r\n\t\t\trenderer.setPixelRatio( window.devicePixelRatio );\r\n\t\t\trenderer.outputEncoding = THREE.sRGBEncoding;\r\n\r\n\t\t\tvar loader = new THREE.ObjectLoader();\r\n\t\t\tvar camera, scene;\r\n\r\n\t\t\tvar vrButton = VRButton.createButton( renderer );\r\n\r\n\t\t\tvar events = {};\r\n\r\n\t\t\tvar dom = document.createElement( 'div' );\r\n\t\t\tdom.appendChild( renderer.domElement );\r\n\r\n\t\t\tthis.dom = dom;\r\n\r\n\t\t\tthis.width = 500;\r\n\t\t\tthis.height = 500;\r\n\r\n\t\t\tthis.load = function ( json ) {\r\n\r\n\t\t\t\tvar project = json.project;\r\n\r\n\t\t\t\trenderer.shadowMap.enabled = project.shadows === true;\r\n\t\t\t\trenderer.xr.enabled = project.vr === true;\r\n\r\n\t\t\t\tthis.setScene( loader.parse( json.scene ) );\r\n\t\t\t\tthis.setCamera( loader.parse( json.camera ) );\r\n\r\n\t\t\t\tevents = {\r\n\t\t\t\t\tinit: [],\r\n\t\t\t\t\tstart: [],\r\n\t\t\t\t\tstop: [],\r\n\t\t\t\t\tkeydown: [],\r\n\t\t\t\t\tkeyup: [],\r\n\t\t\t\t\tmousedown: [],\r\n\t\t\t\t\tmouseup: [],\r\n\t\t\t\t\tmousemove: [],\r\n\t\t\t\t\ttouchstart: [],\r\n\t\t\t\t\ttouchend: [],\r\n\t\t\t\t\ttouchmove: [],\r\n\t\t\t\t\tupdate: []\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvar scriptWrapParams = 'player,renderer,scene,camera';\r\n\t\t\t\tvar scriptWrapResultObj = {};\r\n\r\n\t\t\t\tfor ( var eventKey in events ) {\r\n\r\n\t\t\t\t\tscriptWrapParams += ',' + eventKey;\r\n\t\t\t\t\tscriptWrapResultObj[ eventKey ] = eventKey;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar scriptWrapResult = JSON.stringify( scriptWrapResultObj ).replace( /\\\"/g, '' );\r\n\r\n\t\t\t\tfor ( var uuid in json.scripts ) {\r\n\r\n\t\t\t\t\tvar object = scene.getObjectByProperty( 'uuid', uuid, true );\r\n\r\n\t\t\t\t\tif ( object === undefined ) {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'APP.Player: Script without object.', uuid );\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar scripts = json.scripts[ uuid ];\r\n\r\n\t\t\t\t\tfor ( var i = 0; i < scripts.length; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar script = scripts[ i ];\r\n\r\n\t\t\t\t\t\tvar functions = ( new Function( scriptWrapParams, script.source + '\\nreturn ' + scriptWrapResult + ';' ).bind( object ) )( this, renderer, scene, camera );\r\n\r\n\t\t\t\t\t\tfor ( var name in functions ) {\r\n\r\n\t\t\t\t\t\t\tif ( functions[ name ] === undefined ) continue;\r\n\r\n\t\t\t\t\t\t\tif ( events[ name ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.warn( 'APP.Player: Event type not supported (', name, ')' );\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tevents[ name ].push( functions[ name ].bind( object ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdispatch( events.init, arguments );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tthis.setCamera = function ( value ) {\r\n\r\n\t\t\t\tcamera = value;\r\n\t\t\t\tcamera.aspect = this.width / this.height;\r\n\t\t\t\tcamera.updateProjectionMatrix();\r\n\r\n\t\t\t};\r\n\r\n\t\t\tthis.setScene = function ( value ) {\r\n\r\n\t\t\t\tscene = value;\r\n\r\n\t\t\t};\r\n\r\n\t\t\tthis.setSize = function ( width, height ) {\r\n\r\n\t\t\t\tthis.width = width;\r\n\t\t\t\tthis.height = height;\r\n\r\n\t\t\t\tif ( camera ) {\r\n\r\n\t\t\t\t\tcamera.aspect = this.width / this.height;\r\n\t\t\t\t\tcamera.updateProjectionMatrix();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( renderer ) {\r\n\r\n\t\t\t\t\trenderer.setSize( width, height );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t\tfunction dispatch( array, event ) {\r\n\r\n\t\t\t\tfor ( var i = 0, l = array.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tarray[ i ]( event );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar time, prevTime;\r\n\r\n\t\t\tfunction animate() {\r\n\r\n\t\t\t\ttime = performance.now();\r\n\r\n\t\t\t\ttry {\r\n\r\n\t\t\t\t\tdispatch( events.update, { time: time, delta: time - prevTime } );\r\n\r\n\t\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\t\tconsole.error( ( e.message || e ), ( e.stack || \"\" ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\trenderer.render( scene, camera );\r\n\r\n\t\t\t\tprevTime = time;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.play = function () {\r\n\r\n\t\t\t\tif ( renderer.xr.enabled ) dom.append( vrButton );\r\n\r\n\t\t\t\tprevTime = performance.now();\r\n\r\n\t\t\t\tdocument.addEventListener( 'keydown', onDocumentKeyDown );\r\n\t\t\t\tdocument.addEventListener( 'keyup', onDocumentKeyUp );\r\n\t\t\t\tdocument.addEventListener( 'mousedown', onDocumentMouseDown );\r\n\t\t\t\tdocument.addEventListener( 'mouseup', onDocumentMouseUp );\r\n\t\t\t\tdocument.addEventListener( 'mousemove', onDocumentMouseMove );\r\n\t\t\t\tdocument.addEventListener( 'touchstart', onDocumentTouchStart );\r\n\t\t\t\tdocument.addEventListener( 'touchend', onDocumentTouchEnd );\r\n\t\t\t\tdocument.addEventListener( 'touchmove', onDocumentTouchMove );\r\n\r\n\t\t\t\tdispatch( events.start, arguments );\r\n\r\n\t\t\t\trenderer.setAnimationLoop( animate );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tthis.stop = function () {\r\n\r\n\t\t\t\tif ( renderer.xr.enabled ) vrButton.remove();\r\n\r\n\t\t\t\tdocument.removeEventListener( 'keydown', onDocumentKeyDown );\r\n\t\t\t\tdocument.removeEventListener( 'keyup', onDocumentKeyUp );\r\n\t\t\t\tdocument.removeEventListener( 'mousedown', onDocumentMouseDown );\r\n\t\t\t\tdocument.removeEventListener( 'mouseup', onDocumentMouseUp );\r\n\t\t\t\tdocument.removeEventListener( 'mousemove', onDocumentMouseMove );\r\n\t\t\t\tdocument.removeEventListener( 'touchstart', onDocumentTouchStart );\r\n\t\t\t\tdocument.removeEventListener( 'touchend', onDocumentTouchEnd );\r\n\t\t\t\tdocument.removeEventListener( 'touchmove', onDocumentTouchMove );\r\n\r\n\t\t\t\tdispatch( events.stop, arguments );\r\n\r\n\t\t\t\trenderer.setAnimationLoop( null );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tthis.dispose = function () {\r\n\r\n\t\t\t\trenderer.dispose();\r\n\r\n\t\t\t\tcamera = undefined;\r\n\t\t\t\tscene = undefined;\r\n\r\n\t\t\t};\r\n\r\n\t\t\t//\r\n\r\n\t\t\tfunction onDocumentKeyDown( event ) {\r\n\r\n\t\t\t\tdispatch( events.keydown, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onDocumentKeyUp( event ) {\r\n\r\n\t\t\t\tdispatch( events.keyup, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onDocumentMouseDown( event ) {\r\n\r\n\t\t\t\tdispatch( events.mousedown, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onDocumentMouseUp( event ) {\r\n\r\n\t\t\t\tdispatch( events.mouseup, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onDocumentMouseMove( event ) {\r\n\r\n\t\t\t\tdispatch( events.mousemove, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onDocumentTouchStart( event ) {\r\n\r\n\t\t\t\tdispatch( events.touchstart, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onDocumentTouchEnd( event ) {\r\n\r\n\t\t\t\tdispatch( events.touchend, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onDocumentTouchMove( event ) {\r\n\r\n\t\t\t\tdispatch( events.touchmove, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn APP;\r\n\t\r\n});"]}