{"version":3,"sources":["sideitems/History.js"],"names":["define","mrdoobui","ThreeUI","SidebarHistory","editor","strings","signals","config","history","container","UIPanel","add","UIText","getKey","toUpperCase","persistent","UIBoolean","setPosition","setRight","onChange","value","this","getValue","setKey","alert","lastUndoCmd","undos","length","lastUndoId","undefined","id","enableSerialization","historyChanged","dispatch","UIBreak","ignoreObjectSelectedSignal","outliner","UIOutliner","goToState","parseInt","refreshUI","options","buildOption","object","option","document","createElement","objects","i","l","innerHTML","name","push","style","opacity","redos","setOptions","editorCleared","cmd","setValue"],"mappings":";;;;;;;AAAAA,QACI,mBACA,aACD,SAAUC,EAAUC,GACnB,aAoEA,OAASC,eAnEY,SAAUC,GAC3B,IAAIC,EAAUD,EAAOC,QACjBC,EAAUF,EAAOE,QACjBC,EAASH,EAAOG,OAChBC,EAAUJ,EAAOI,QACjBC,EAAY,IAAIR,EAASS,QAC7BD,EAAUE,IAAI,IAAIV,EAASW,OAAOP,EAAQQ,OAAO,mBAAmBC,gBACpE,IAAIC,EAAa,IAAIb,EAAQc,UAAUT,EAAOM,OAAO,oBAAqBR,EAAQQ,OAAO,+BACzFE,EAAWE,YAAY,YAAYC,SAAS,OAC5CH,EAAWI,SAAS,WAChB,IAAIC,EAAQC,KAAKC,WAEjB,GADAf,EAAOgB,OAAO,mBAAoBH,GAC9BA,EAAO,CACPI,MAAM,sHACN,IAAIC,EAAcjB,EAAQkB,MAAMlB,EAAQkB,MAAMC,OAAS,GACnDC,OAA6BC,IAAhBJ,EAA4BA,EAAYK,GAAK,EAC9D1B,EAAOI,QAAQuB,oBAAoBH,QAEnCtB,EAAQ0B,eAAeC,aAG/BxB,EAAUE,IAAII,GACdN,EAAUE,IAAI,IAAIV,EAASiC,QAAW,IAAIjC,EAASiC,SACnD,IAAIC,GAA6B,EAC7BC,EAAW,IAAIlC,EAAQmC,WAAWjC,GACtCgC,EAASjB,SAAS,WACdgB,GAA6B,EAC7B/B,EAAOI,QAAQ8B,UAAUC,SAASH,EAASd,aAC3Ca,GAA6B,IAEjC1B,EAAUE,IAAIyB,GACd,IAAII,EAAY,WACZ,IAAIC,KACJ,SAASC,EAAYC,GACjB,IAAIC,EAASC,SAASC,cAAc,OAEpC,OADAF,EAAOxB,MAAQuB,EAAOb,GACfc,GAEV,SAAoBG,GACjB,IAAK,IAAIC,EAAI,EAAGC,EAAIF,EAAQpB,OAAQqB,EAAIC,EAAGD,IAAK,CAC5C,IAAIL,EAASI,EAAQC,GACjBJ,EAASF,EAAYC,GACzBC,EAAOM,UAAY,SAAWP,EAAOQ,KACrCV,EAAQW,KAAKR,IALrB,CAOEpC,EAAQkB,OACT,SAAoBqB,GACjB,IAAK,IAAIC,EAAID,EAAQpB,OAAS,EAAGqB,GAAK,EAAGA,IAAK,CAC1C,IAAIL,EAASI,EAAQC,GACjBJ,EAASF,EAAYC,GACzBC,EAAOM,UAAY,SAAWP,EAAOQ,KACrCP,EAAOS,MAAMC,QAAU,GACvBb,EAAQW,KAAKR,IANrB,CAQEpC,EAAQ+C,OACVnB,EAASoB,WAAWf,IAUxB,OARAD,IACAlC,EAAQmD,cAAc9C,IAAI6B,GAC1BlC,EAAQ0B,eAAerB,IAAI6B,GAC3BlC,EAAQ0B,eAAerB,IAAI,SAAU+C,IACE,IAA/BvB,GAEJC,EAASuB,cAAiB9B,IAAR6B,EAAoBA,EAAI5B,GAAK,QAE5CrB","file":"../../sideitems/History.js","sourcesContent":["define([\n    'skylark-mrdoobui',\n    './ThreeUI'\n], function (mrdoobui, ThreeUI) {\n    'use strict';\n    var SidebarHistory = function (editor) {\n        var strings = editor.strings;\n        var signals = editor.signals;\n        var config = editor.config;\n        var history = editor.history;\n        var container = new mrdoobui.UIPanel();\n        container.add(new mrdoobui.UIText(strings.getKey('sidebar/history').toUpperCase()));\n        var persistent = new ThreeUI.UIBoolean(config.getKey('settings/history'), strings.getKey('sidebar/history/persistent'));\n        persistent.setPosition('absolute').setRight('8px');\n        persistent.onChange(function () {\n            var value = this.getValue();\n            config.setKey('settings/history', value);\n            if (value) {\n                alert('The history will be preserved across sessions.\\nThis can have an impact on performance when working with textures.');\n                var lastUndoCmd = history.undos[history.undos.length - 1];\n                var lastUndoId = lastUndoCmd !== undefined ? lastUndoCmd.id : 0;\n                editor.history.enableSerialization(lastUndoId);\n            } else {\n                signals.historyChanged.dispatch();\n            }\n        });\n        container.add(persistent);\n        container.add(new mrdoobui.UIBreak(), new mrdoobui.UIBreak());\n        var ignoreObjectSelectedSignal = false;\n        var outliner = new ThreeUI.UIOutliner(editor);\n        outliner.onChange(function () {\n            ignoreObjectSelectedSignal = true;\n            editor.history.goToState(parseInt(outliner.getValue()));\n            ignoreObjectSelectedSignal = false;\n        });\n        container.add(outliner);\n        var refreshUI = function () {\n            var options = [];\n            function buildOption(object) {\n                var option = document.createElement('div');\n                option.value = object.id;\n                return option;\n            }\n            (function addObjects(objects) {\n                for (var i = 0, l = objects.length; i < l; i++) {\n                    var object = objects[i];\n                    var option = buildOption(object);\n                    option.innerHTML = '&nbsp;' + object.name;\n                    options.push(option);\n                }\n            }(history.undos));\n            (function addObjects(objects) {\n                for (var i = objects.length - 1; i >= 0; i--) {\n                    var object = objects[i];\n                    var option = buildOption(object);\n                    option.innerHTML = '&nbsp;' + object.name;\n                    option.style.opacity = 0.3;\n                    options.push(option);\n                }\n            }(history.redos));\n            outliner.setOptions(options);\n        };\n        refreshUI();\n        signals.editorCleared.add(refreshUI);\n        signals.historyChanged.add(refreshUI);\n        signals.historyChanged.add(function (cmd) {\n            if (ignoreObjectSelectedSignal === true)\n                return;\n            outliner.setValue(cmd !== undefined ? cmd.id : null);\n        });\n        return container;\n    };\n    return { SidebarHistory };\n});"]}