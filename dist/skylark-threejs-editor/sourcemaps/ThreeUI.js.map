{"version":3,"sources":["ThreeUI.js"],"names":["define","mrdoobui","THREE","RGBELoader","TGALoader","MoveObjectCommand","UIElement","UISpan","UIDiv","UIRow","UIButton","UICheckbox","UIText","UINumber","UITexture","mapping","call","this","scope","dom","document","createElement","form","input","type","addEventListener","event","loadFile","target","files","appendChild","canvas","file","match","reader","FileReader","parse","result","texture","CanvasTexture","sourceFile","name","setValue","onChangeCallback","readAsArrayBuffer","image","Texture","format","RGBFormat","RGBAFormat","needsUpdate","src","readAsDataURL","split","pop","setDataType","UnsignedByteType","load","hdrTexture","isHDRTexture","reset","width","height","style","cursor","marginRight","border","click","preventDefault","stopPropagation","dataTransfer","prototype","Object","create","constructor","getValue","children","context","getContext","undefined","title","scale","data","drawImage","canvas2","renderer","WebGLRenderer","OffscreenCanvas","setSize","toneMapping","ReinhardToneMapping","toneMappingExposure","outputEncoding","sRGBEncoding","scene","Scene","camera","OrthographicCamera","material","MeshBasicMaterial","map","quad","PlaneBufferGeometry","mesh","Mesh","add","render","domElement","renderToCanvas","clearRect","setEncoding","encoding","onChange","callback","UICubeTexture","container","cubeTexture","textures","pRow","nRow","setWidth","posXTexture","onTextureChanged","negXTexture","posYTexture","negYTexture","posZTexture","negZTexture","images","i","length","push","CubeTexture","Array","isArray","UIOutliner","editor","className","tabIndex","keyCode","selectIndex","selectedIndex","options","selectedValue","index","value","changeEvent","createEvent","initEvent","dispatchEvent","setOptions","currentDrag","removeChild","firstChild","onClick","onDrag","onDragStart","setData","onDragOver","area","offsetY","clientHeight","onDragLeave","onDrop","object","getObjectById","moveObject","nextObject","parent","nextSibling","newParent","newParentIsChild","traverse","child","execute","div","draggable","element","classList","y","offsetTop","minScroll","offsetHeight","scrollTop","remove","UIPoints","onAddClicked","span","setDisplay","pointsList","row","addPointButton","update","bind","pointsUI","lastPointIdx","clear","deletePointRow","idx","dontUpdate","UIPoints2","addRow","createPointRow","point","x","points","count","pointUI","Vector2","lbl","pointRow","txtX","txtY","btn","isEditing","UIPoints3","z","Vector3","txtZ","UIBoolean","boolean","text","setMarginRight","checkbox","setMarginLeft"],"mappings":"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","file":"../ThreeUI.js","sourcesContent":["define([\r\n    'skylark-mrdoobui',\r\n\t\"skylark-threejs\",\r\n    \"skylark-threejs-ex/loaders/RGBELoader\",\r\n    \"skylark-threejs-ex/loaders/TGALoader\",\r\n    \"./commands/MoveObjectCommand\"\r\n\r\n],function(\r\n\tmrdoobui,\r\n\tTHREE,\r\n\tRGBELoader,\r\n\tTGALoader,\r\n\tMoveObjectCommand\r\n){\r\n\r\n\r\n\r\n\tconst { UIElement, UISpan, UIDiv, UIRow, UIButton, UICheckbox, UIText, UINumber } = mrdoobui;\r\n\r\n\t/**\r\n\t * @author mrdoob / http://mrdoob.com/\r\n\t */\r\n\r\n\tvar UITexture = function ( mapping ) {\r\n\r\n\t\tUIElement.call( this );\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar dom = document.createElement( 'span' );\r\n\r\n\t\tvar form = document.createElement( 'form' );\r\n\r\n\t\tvar input = document.createElement( 'input' );\r\n\t\tinput.type = 'file';\r\n\t\tinput.addEventListener( 'change', function ( event ) {\r\n\r\n\t\t\tloadFile( event.target.files[ 0 ] );\r\n\r\n\t\t} );\r\n\t\tform.appendChild( input );\r\n\r\n\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = 32;\r\n\t\tcanvas.height = 16;\r\n\t\tcanvas.style.cursor = 'pointer';\r\n\t\tcanvas.style.marginRight = '5px';\r\n\t\tcanvas.style.border = '1px solid #888';\r\n\t\tcanvas.addEventListener( 'click', function () {\r\n\r\n\t\t\tinput.click();\r\n\r\n\t\t}, false );\r\n\t\tcanvas.addEventListener( 'drop', function () {\r\n\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tloadFile( event.dataTransfer.files[ 0 ] );\r\n\r\n\t\t}, false );\r\n\t\tdom.appendChild( canvas );\r\n\r\n\t\tfunction loadFile( file ) {\r\n\r\n\t\t\tif ( file.type.match( 'image.*' ) ) {\r\n\r\n\t\t\t\tvar reader = new FileReader();\r\n\r\n\t\t\t\tif ( file.type === 'image/targa' ) {\r\n\r\n\t\t\t\t\treader.addEventListener( 'load', function ( event ) {\r\n\r\n\t\t\t\t\t\tvar canvas = new TGALoader().parse( event.target.result );\r\n\r\n\t\t\t\t\t\tvar texture = new THREE.CanvasTexture( canvas, mapping );\r\n\t\t\t\t\t\ttexture.sourceFile = file.name;\r\n\r\n\t\t\t\t\t\tscope.setValue( texture );\r\n\r\n\t\t\t\t\t\tif ( scope.onChangeCallback ) scope.onChangeCallback( texture );\r\n\r\n\t\t\t\t\t}, false );\r\n\r\n\t\t\t\t\treader.readAsArrayBuffer( file );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\treader.addEventListener( 'load', function ( event ) {\r\n\r\n\t\t\t\t\t\tvar image = document.createElement( 'img' );\r\n\t\t\t\t\t\timage.addEventListener( 'load', function () {\r\n\r\n\t\t\t\t\t\t\tvar texture = new THREE.Texture( this, mapping );\r\n\t\t\t\t\t\t\ttexture.sourceFile = file.name;\r\n\t\t\t\t\t\t\ttexture.format = file.type === 'image/jpeg' ? THREE.RGBFormat : THREE.RGBAFormat;\r\n\t\t\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t\t\t\tscope.setValue( texture );\r\n\r\n\t\t\t\t\t\t\tif ( scope.onChangeCallback ) scope.onChangeCallback( texture );\r\n\r\n\t\t\t\t\t\t}, false );\r\n\r\n\t\t\t\t\t\timage.src = event.target.result;\r\n\r\n\t\t\t\t\t}, false );\r\n\r\n\t\t\t\t\treader.readAsDataURL( file );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar reader = new FileReader();\r\n\t\t\t\treader.addEventListener( 'load', function ( event ) {\r\n\r\n\t\t\t\t\tif ( file.name.split( '.' ).pop() === 'hdr' ) {\r\n\r\n\t\t\t\t\t\t// assuming RGBE/Radiance HDR iamge format\r\n\r\n\t\t\t\t\t\tvar loader = new RGBELoader().setDataType( THREE.UnsignedByteType );\r\n\t\t\t\t\t\tloader.load( event.target.result, function ( hdrTexture ) {\r\n\r\n\t\t\t\t\t\t\thdrTexture.sourceFile = file.name;\r\n\t\t\t\t\t\t\thdrTexture.isHDRTexture = true;\r\n\r\n\t\t\t\t\t\t\tscope.setValue( hdrTexture );\r\n\r\n\t\t\t\t\t\t\tif ( scope.onChangeCallback ) scope.onChangeCallback( hdrTexture );\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\treader.readAsDataURL( file );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tform.reset();\r\n\r\n\t\t}\r\n\r\n\t\tthis.dom = dom;\r\n\t\tthis.texture = null;\r\n\t\tthis.onChangeCallback = null;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUITexture.prototype = Object.create( UIElement.prototype );\r\n\tUITexture.prototype.constructor = UITexture;\r\n\r\n\tUITexture.prototype.getValue = function () {\r\n\r\n\t\treturn this.texture;\r\n\r\n\t};\r\n\r\n\tUITexture.prototype.setValue = function ( texture ) {\r\n\r\n\t\tvar canvas = this.dom.children[ 0 ];\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\r\n\t\tif ( texture !== null ) {\r\n\r\n\t\t\tvar image = texture.image;\r\n\r\n\t\t\tif ( image !== undefined && image.width > 0 ) {\r\n\r\n\t\t\t\tcanvas.title = texture.sourceFile;\r\n\t\t\t\tvar scale = canvas.width / image.width;\r\n\r\n\t\t\t\tif ( image.data === undefined ) {\r\n\r\n\t\t\t\t\tcontext.drawImage( image, 0, 0, image.width * scale, image.height * scale );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvar canvas2 = renderToCanvas( texture );\r\n\t\t\t\t\tcontext.drawImage( canvas2, 0, 0, image.width * scale, image.height * scale );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcanvas.title = texture.sourceFile + ' (error)';\r\n\t\t\t\tcontext.clearRect( 0, 0, canvas.width, canvas.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tcanvas.title = 'empty';\r\n\r\n\t\t\tif ( context !== null ) {\r\n\r\n\t\t\t\t// Seems like context can be null if the canvas is not visible\r\n\r\n\t\t\t\tcontext.clearRect( 0, 0, canvas.width, canvas.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.texture = texture;\r\n\r\n\t};\r\n\r\n\tUITexture.prototype.setEncoding = function ( encoding ) {\r\n\r\n\t\tvar texture = this.getValue();\r\n\t\tif ( texture !== null ) {\r\n\r\n\t\t\ttexture.encoding = encoding;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUITexture.prototype.onChange = function ( callback ) {\r\n\r\n\t\tthis.onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\t// UICubeTexture\r\n\r\n\tvar UICubeTexture = function () {\r\n\r\n\t\tUIElement.call( this );\r\n\r\n\t\tvar container = new UIDiv();\r\n\r\n\t\tthis.cubeTexture = null;\r\n\t\tthis.onChangeCallback = null;\r\n\t\tthis.dom = container.dom;\r\n\r\n\t\tthis.textures = [];\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar pRow = new UIRow();\r\n\t\tvar nRow = new UIRow();\r\n\r\n\t\tpRow.add( new UIText( 'P:' ).setWidth( '35px' ) );\r\n\t\tnRow.add( new UIText( 'N:' ).setWidth( '35px' ) );\r\n\r\n\t\tvar posXTexture = new UITexture().onChange( onTextureChanged );\r\n\t\tvar negXTexture = new UITexture().onChange( onTextureChanged );\r\n\t\tvar posYTexture = new UITexture().onChange( onTextureChanged );\r\n\t\tvar negYTexture = new UITexture().onChange( onTextureChanged );\r\n\t\tvar posZTexture = new UITexture().onChange( onTextureChanged );\r\n\t\tvar negZTexture = new UITexture().onChange( onTextureChanged );\r\n\r\n\t\tthis.textures.push( posXTexture, negXTexture, posYTexture, negYTexture, posZTexture, negZTexture );\r\n\r\n\t\tpRow.add( posXTexture );\r\n\t\tpRow.add( posYTexture );\r\n\t\tpRow.add( posZTexture );\r\n\r\n\t\tnRow.add( negXTexture );\r\n\t\tnRow.add( negYTexture );\r\n\t\tnRow.add( negZTexture );\r\n\r\n\t\tcontainer.add( pRow, nRow );\r\n\r\n\t\tfunction onTextureChanged() {\r\n\r\n\t\t\tvar images = [];\r\n\r\n\t\t\tfor ( var i = 0; i < scope.textures.length; i ++ ) {\r\n\r\n\t\t\t\tvar texture = scope.textures[ i ].getValue();\r\n\r\n\t\t\t\tif ( texture !== null ) {\r\n\r\n\t\t\t\t\timages.push( texture.isHDRTexture ? texture : texture.image );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( images.length === 6 ) {\r\n\r\n\t\t\t\tvar cubeTexture = new THREE.CubeTexture( images );\r\n\t\t\t\tcubeTexture.needsUpdate = true;\r\n\r\n\t\t\t\tif ( images[ 0 ].isHDRTexture ) cubeTexture.isHDRTexture = true;\r\n\r\n\t\t\t\tscope.cubeTexture = cubeTexture;\r\n\r\n\t\t\t\tif ( scope.onChangeCallback ) scope.onChangeCallback( cubeTexture );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tUICubeTexture.prototype = Object.create( UIElement.prototype );\r\n\tUICubeTexture.prototype.constructor = UICubeTexture;\r\n\r\n\tUICubeTexture.prototype.setEncoding = function ( encoding ) {\r\n\r\n\t\tvar cubeTexture = this.getValue();\r\n\t\tif ( cubeTexture !== null ) {\r\n\r\n\t\t\tcubeTexture.encoding = encoding;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUICubeTexture.prototype.getValue = function () {\r\n\r\n\t\treturn this.cubeTexture;\r\n\r\n\t};\r\n\r\n\tUICubeTexture.prototype.setValue = function ( cubeTexture ) {\r\n\r\n\t\tthis.cubeTexture = cubeTexture;\r\n\r\n\t\tif ( cubeTexture !== null ) {\r\n\r\n\t\t\tvar images = cubeTexture.image;\r\n\r\n\t\t\tif ( Array.isArray( images ) === true && images.length === 6 ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < images.length; i ++ ) {\r\n\r\n\t\t\t\t\tvar image = images[ i ];\r\n\r\n\t\t\t\t\tvar texture = new THREE.Texture( image );\r\n\t\t\t\t\tthis.textures[ i ].setValue( texture );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar textures = this.textures;\r\n\r\n\t\t\tfor ( var i = 0; i < textures.length; i ++ ) {\r\n\r\n\t\t\t\ttextures[ i ].setValue( null );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUICubeTexture.prototype.onChange = function ( callback ) {\r\n\r\n\t\tthis.onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\t// UIOutliner\r\n\r\n\tvar UIOutliner = function ( editor ) {\r\n\r\n\t\tUIElement.call( this );\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar dom = document.createElement( 'div' );\r\n\t\tdom.className = 'Outliner';\r\n\t\tdom.tabIndex = 0;\t// keyup event is ignored without setting tabIndex\r\n\r\n\t\t// hack\r\n\t\tthis.scene = editor.scene;\r\n\r\n\t\t// Prevent native scroll behavior\r\n\t\tdom.addEventListener( 'keydown', function ( event ) {\r\n\r\n\t\t\tswitch ( event.keyCode ) {\r\n\r\n\t\t\t\tcase 38: // up\r\n\t\t\t\tcase 40: // down\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}, false );\r\n\r\n\t\t// Keybindings to support arrow navigation\r\n\t\tdom.addEventListener( 'keyup', function ( event ) {\r\n\r\n\t\t\tswitch ( event.keyCode ) {\r\n\r\n\t\t\t\tcase 38: // up\r\n\t\t\t\t\tscope.selectIndex( scope.selectedIndex - 1 );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 40: // down\r\n\t\t\t\t\tscope.selectIndex( scope.selectedIndex + 1 );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}, false );\r\n\r\n\t\tthis.dom = dom;\r\n\t\tthis.editor = editor;\r\n\r\n\t\tthis.options = [];\r\n\t\tthis.selectedIndex = - 1;\r\n\t\tthis.selectedValue = null;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUIOutliner.prototype = Object.create( UIElement.prototype );\r\n\tUIOutliner.prototype.constructor = UIOutliner;\r\n\r\n\tUIOutliner.prototype.selectIndex = function ( index ) {\r\n\r\n\t\tif ( index >= 0 && index < this.options.length ) {\r\n\r\n\t\t\tthis.setValue( this.options[ index ].value );\r\n\r\n\t\t\tvar changeEvent = document.createEvent( 'HTMLEvents' );\r\n\t\t\tchangeEvent.initEvent( 'change', true, true );\r\n\t\t\tthis.dom.dispatchEvent( changeEvent );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tUIOutliner.prototype.setOptions = function ( options ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\twhile ( scope.dom.children.length > 0 ) {\r\n\r\n\t\t\tscope.dom.removeChild( scope.dom.firstChild );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onClick() {\r\n\r\n\t\t\tscope.setValue( this.value );\r\n\r\n\t\t\tvar changeEvent = document.createEvent( 'HTMLEvents' );\r\n\t\t\tchangeEvent.initEvent( 'change', true, true );\r\n\t\t\tscope.dom.dispatchEvent( changeEvent );\r\n\r\n\t\t}\r\n\r\n\t\t// Drag\r\n\r\n\t\tvar currentDrag;\r\n\r\n\t\tfunction onDrag() {\r\n\r\n\t\t\tcurrentDrag = this;\r\n\r\n\t\t}\r\n\r\n\t\tfunction onDragStart( event ) {\r\n\r\n\t\t\tevent.dataTransfer.setData( 'text', 'foo' );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onDragOver( event ) {\r\n\r\n\t\t\tif ( this === currentDrag ) return;\r\n\r\n\t\t\tvar area = event.offsetY / this.clientHeight;\r\n\r\n\t\t\tif ( area < 0.25 ) {\r\n\r\n\t\t\t\tthis.className = 'option dragTop';\r\n\r\n\t\t\t} else if ( area > 0.75 ) {\r\n\r\n\t\t\t\tthis.className = 'option dragBottom';\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.className = 'option drag';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onDragLeave() {\r\n\r\n\t\t\tif ( this === currentDrag ) return;\r\n\r\n\t\t\tthis.className = 'option';\r\n\r\n\t\t}\r\n\r\n\t\tfunction onDrop( event ) {\r\n\r\n\t\t\tif ( this === currentDrag ) return;\r\n\r\n\t\t\tthis.className = 'option';\r\n\r\n\t\t\tvar scene = scope.scene;\r\n\t\t\tvar object = scene.getObjectById( currentDrag.value );\r\n\r\n\t\t\tvar area = event.offsetY / this.clientHeight;\r\n\r\n\t\t\tif ( area < 0.25 ) {\r\n\r\n\t\t\t\tvar nextObject = scene.getObjectById( this.value );\r\n\t\t\t\tmoveObject( object, nextObject.parent, nextObject );\r\n\r\n\t\t\t} else if ( area > 0.75 ) {\r\n\r\n\t\t\t\tvar nextObject, parent;\r\n\r\n\t\t\t\tif ( this.nextSibling !== null ) {\r\n\r\n\t\t\t\t\tnextObject = scene.getObjectById( this.nextSibling.value );\r\n\t\t\t\t\tparent = nextObject.parent;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// end of list (no next object)\r\n\r\n\t\t\t\t\tnextObject = null;\r\n\t\t\t\t\tparent = scene.getObjectById( this.value ).parent;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmoveObject( object, parent, nextObject );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar parentObject = scene.getObjectById( this.value );\r\n\t\t\t\tmoveObject( object, parentObject );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction moveObject( object, newParent, nextObject ) {\r\n\r\n\t\t\tif ( nextObject === null ) nextObject = undefined;\r\n\r\n\t\t\tvar newParentIsChild = false;\r\n\r\n\t\t\tobject.traverse( function ( child ) {\r\n\r\n\t\t\t\tif ( child === newParent ) newParentIsChild = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( newParentIsChild ) return;\r\n\r\n\t\t\tvar editor = scope.editor;\r\n\t\t\teditor.execute( new MoveObjectCommand( editor, object, newParent, nextObject ) );\r\n\r\n\t\t\tvar changeEvent = document.createEvent( 'HTMLEvents' );\r\n\t\t\tchangeEvent.initEvent( 'change', true, true );\r\n\t\t\tscope.dom.dispatchEvent( changeEvent );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tscope.options = [];\r\n\r\n\t\tfor ( var i = 0; i < options.length; i ++ ) {\r\n\r\n\t\t\tvar div = options[ i ];\r\n\t\t\tdiv.className = 'option';\r\n\t\t\tscope.dom.appendChild( div );\r\n\r\n\t\t\tscope.options.push( div );\r\n\r\n\t\t\tdiv.addEventListener( 'click', onClick, false );\r\n\r\n\t\t\tif ( div.draggable === true ) {\r\n\r\n\t\t\t\tdiv.addEventListener( 'drag', onDrag, false );\r\n\t\t\t\tdiv.addEventListener( 'dragstart', onDragStart, false ); // Firefox needs this\r\n\r\n\t\t\t\tdiv.addEventListener( 'dragover', onDragOver, false );\r\n\t\t\t\tdiv.addEventListener( 'dragleave', onDragLeave, false );\r\n\t\t\t\tdiv.addEventListener( 'drop', onDrop, false );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\r\n\t\treturn scope;\r\n\r\n\t};\r\n\r\n\tUIOutliner.prototype.getValue = function () {\r\n\r\n\t\treturn this.selectedValue;\r\n\r\n\t};\r\n\r\n\tUIOutliner.prototype.setValue = function ( value ) {\r\n\r\n\t\tfor ( var i = 0; i < this.options.length; i ++ ) {\r\n\r\n\t\t\tvar element = this.options[ i ];\r\n\r\n\t\t\tif ( element.value === value ) {\r\n\r\n\t\t\t\telement.classList.add( 'active' );\r\n\r\n\t\t\t\t// scroll into view\r\n\r\n\t\t\t\tvar y = element.offsetTop - this.dom.offsetTop;\r\n\t\t\t\tvar bottomY = y + element.offsetHeight;\r\n\t\t\t\tvar minScroll = bottomY - this.dom.offsetHeight;\r\n\r\n\t\t\t\tif ( this.dom.scrollTop > y ) {\r\n\r\n\t\t\t\t\tthis.dom.scrollTop = y;\r\n\r\n\t\t\t\t} else if ( this.dom.scrollTop < minScroll ) {\r\n\r\n\t\t\t\t\tthis.dom.scrollTop = minScroll;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.selectedIndex = i;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\telement.classList.remove( 'active' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.selectedValue = value;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tvar UIPoints = function ( onAddClicked ) {\r\n\r\n\t\tUIElement.call( this );\r\n\r\n\t\tvar span = new UISpan().setDisplay( 'inline-block' );\r\n\r\n\t\tthis.pointsList = new UIDiv();\r\n\t\tspan.add( this.pointsList );\r\n\r\n\t\tvar row = new UIRow();\r\n\t\tspan.add( row );\r\n\r\n\t\tvar addPointButton = new UIButton( '+' ).onClick( onAddClicked );\r\n\t\trow.add( addPointButton );\r\n\r\n\t\tthis.update = function () {\r\n\r\n\t\t\tif ( this.onChangeCallback !== null ) {\r\n\r\n\t\t\t\tthis.onChangeCallback();\r\n\r\n\t\t\t}\r\n\r\n\t\t}.bind( this );\r\n\r\n\t\tthis.dom = span.dom;\r\n\t\tthis.pointsUI = [];\r\n\t\tthis.lastPointIdx = 0;\r\n\t\tthis.onChangeCallback = null;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUIPoints.prototype = Object.create( UIElement.prototype );\r\n\tUIPoints.prototype.constructor = UIPoints;\r\n\r\n\tUIPoints.prototype.onChange = function ( callback ) {\r\n\r\n\t\tthis.onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUIPoints.prototype.clear = function () {\r\n\r\n\t\tfor ( var i = 0; i < this.pointsUI.length; ++ i ) {\r\n\r\n\t\t\tif ( this.pointsUI[ i ] ) {\r\n\r\n\t\t\t\tthis.deletePointRow( i, true );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.lastPointIdx = 0;\r\n\r\n\t};\r\n\r\n\tUIPoints.prototype.deletePointRow = function ( idx, dontUpdate ) {\r\n\r\n\t\tif ( ! this.pointsUI[ idx ] ) return;\r\n\r\n\t\tthis.pointsList.remove( this.pointsUI[ idx ].row );\r\n\t\tthis.pointsUI[ idx ] = null;\r\n\r\n\t\tif ( dontUpdate !== true ) {\r\n\r\n\t\t\tthis.update();\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar UIPoints2 = function () {\r\n\r\n\t\tUIPoints.call( this, UIPoints2.addRow.bind( this ) );\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUIPoints2.prototype = Object.create( UIPoints.prototype );\r\n\tUIPoints2.prototype.constructor = UIPoints2;\r\n\r\n\tUIPoints2.addRow = function () {\r\n\r\n\t\tif ( this.pointsUI.length === 0 ) {\r\n\r\n\t\t\tthis.pointsList.add( this.createPointRow( 0, 0 ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar point = this.pointsUI[ this.pointsUI.length - 1 ];\r\n\r\n\t\t\tthis.pointsList.add( this.createPointRow( point.x.getValue(), point.y.getValue() ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\r\n\t};\r\n\r\n\tUIPoints2.prototype.getValue = function () {\r\n\r\n\t\tvar points = [];\r\n\t\tvar count = 0;\r\n\r\n\t\tfor ( var i = 0; i < this.pointsUI.length; i ++ ) {\r\n\r\n\t\t\tvar pointUI = this.pointsUI[ i ];\r\n\r\n\t\t\tif ( ! pointUI ) continue;\r\n\r\n\t\t\tpoints.push( new THREE.Vector2( pointUI.x.getValue(), pointUI.y.getValue() ) );\r\n\t\t\t++ count;\r\n\t\t\tpointUI.lbl.setValue( count );\r\n\r\n\t\t}\r\n\r\n\t\treturn points;\r\n\r\n\t};\r\n\r\n\tUIPoints2.prototype.setValue = function ( points ) {\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tfor ( var i = 0; i < points.length; i ++ ) {\r\n\r\n\t\t\tvar point = points[ i ];\r\n\t\t\tthis.pointsList.add( this.createPointRow( point.x, point.y ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUIPoints2.prototype.createPointRow = function ( x, y ) {\r\n\r\n\t\tvar pointRow = new UIDiv();\r\n\t\tvar lbl = new UIText( this.lastPointIdx + 1 ).setWidth( '20px' );\r\n\t\tvar txtX = new UINumber( x ).setWidth( '30px' ).onChange( this.update );\r\n\t\tvar txtY = new UINumber( y ).setWidth( '30px' ).onChange( this.update );\r\n\r\n\t\tvar idx = this.lastPointIdx;\r\n\t\tvar scope = this;\r\n\t\tvar btn = new UIButton( '-' ).onClick( function () {\r\n\r\n\t\t\tif ( scope.isEditing ) return;\r\n\t\t\tscope.deletePointRow( idx );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.pointsUI.push( { row: pointRow, lbl: lbl, x: txtX, y: txtY } );\r\n\t\t++ this.lastPointIdx;\r\n\t\tpointRow.add( lbl, txtX, txtY, btn );\r\n\r\n\t\treturn pointRow;\r\n\r\n\t};\r\n\r\n\tvar UIPoints3 = function () {\r\n\r\n\t\tUIPoints.call( this, UIPoints3.addRow.bind( this ) );\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUIPoints3.prototype = Object.create( UIPoints.prototype );\r\n\tUIPoints3.prototype.constructor = UIPoints3;\r\n\r\n\tUIPoints3.addRow = function () {\r\n\r\n\t\tif ( this.pointsUI.length === 0 ) {\r\n\r\n\t\t\tthis.pointsList.add( this.createPointRow( 0, 0, 0 ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar point = this.pointsUI[ this.pointsUI.length - 1 ];\r\n\r\n\t\t\tthis.pointsList.add( this.createPointRow( point.x.getValue(), point.y.getValue(), point.z.getValue() ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\r\n\t};\r\n\r\n\tUIPoints3.prototype.getValue = function () {\r\n\r\n\t\tvar points = [];\r\n\t\tvar count = 0;\r\n\r\n\t\tfor ( var i = 0; i < this.pointsUI.length; i ++ ) {\r\n\r\n\t\t\tvar pointUI = this.pointsUI[ i ];\r\n\r\n\t\t\tif ( ! pointUI ) continue;\r\n\r\n\t\t\tpoints.push( new THREE.Vector3( pointUI.x.getValue(), pointUI.y.getValue(), pointUI.z.getValue() ) );\r\n\t\t\t++ count;\r\n\t\t\tpointUI.lbl.setValue( count );\r\n\r\n\t\t}\r\n\r\n\t\treturn points;\r\n\r\n\t};\r\n\r\n\tUIPoints3.prototype.setValue = function ( points ) {\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tfor ( var i = 0; i < points.length; i ++ ) {\r\n\r\n\t\t\tvar point = points[ i ];\r\n\t\t\tthis.pointsList.add( this.createPointRow( point.x, point.y, point.z ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tUIPoints3.prototype.createPointRow = function ( x, y, z ) {\r\n\r\n\t\tvar pointRow = new UIDiv();\r\n\t\tvar lbl = new UIText( this.lastPointIdx + 1 ).setWidth( '20px' );\r\n\t\tvar txtX = new UINumber( x ).setWidth( '30px' ).onChange( this.update );\r\n\t\tvar txtY = new UINumber( y ).setWidth( '30px' ).onChange( this.update );\r\n\t\tvar txtZ = new UINumber( z ).setWidth( '30px' ).onChange( this.update );\r\n\r\n\t\tvar idx = this.lastPointIdx;\r\n\t\tvar scope = this;\r\n\t\tvar btn = new UIButton( '-' ).onClick( function () {\r\n\r\n\t\t\tif ( scope.isEditing ) return;\r\n\t\t\tscope.deletePointRow( idx );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.pointsUI.push( { row: pointRow, lbl: lbl, x: txtX, y: txtY, z: txtZ } );\r\n\t\t++ this.lastPointIdx;\r\n\t\tpointRow.add( lbl, txtX, txtY, txtZ, btn );\r\n\r\n\t\treturn pointRow;\r\n\r\n\t};\r\n\r\n\tvar UIBoolean = function ( boolean, text ) {\r\n\r\n\t\tUISpan.call( this );\r\n\r\n\t\tthis.setMarginRight( '10px' );\r\n\r\n\t\tthis.checkbox = new UICheckbox( boolean );\r\n\t\tthis.text = new UIText( text ).setMarginLeft( '3px' );\r\n\r\n\t\tthis.add( this.checkbox );\r\n\t\tthis.add( this.text );\r\n\r\n\t};\r\n\r\n\tUIBoolean.prototype = Object.create( UISpan.prototype );\r\n\tUIBoolean.prototype.constructor = UIBoolean;\r\n\r\n\tUIBoolean.prototype.getValue = function () {\r\n\r\n\t\treturn this.checkbox.getValue();\r\n\r\n\t};\r\n\r\n\tUIBoolean.prototype.setValue = function ( value ) {\r\n\r\n\t\treturn this.checkbox.setValue( value );\r\n\r\n\t};\r\n\r\n\tvar renderer;\r\n\r\n\tfunction renderToCanvas( texture ) {\r\n\r\n\t\tif ( renderer === undefined ) {\r\n\r\n\t\t\trenderer = new THREE.WebGLRenderer( { canvas: new OffscreenCanvas( 1, 1 ) } );\r\n\r\n\t\t}\r\n\r\n\t\tvar image = texture.image;\r\n\r\n\t\trenderer.setSize( image.width, image.height, false );\r\n\t\trenderer.toneMapping = THREE.ReinhardToneMapping;\r\n\t\trenderer.toneMappingExposure = 2;\r\n\t\trenderer.outputEncoding = THREE.sRGBEncoding;\r\n\r\n\t\tvar scene = new THREE.Scene();\r\n\t\tvar camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\r\n\r\n\t\tvar material = new THREE.MeshBasicMaterial( { map: texture } );\r\n\t\tvar quad = new THREE.PlaneBufferGeometry( 2, 2 );\r\n\t\tvar mesh = new THREE.Mesh( quad, material );\r\n\t\tscene.add( mesh );\r\n\r\n\t\trenderer.render( scene, camera );\r\n\r\n\t\treturn renderer.domElement;\r\n\r\n\t}\r\n\r\n\treturn { UITexture, UICubeTexture, UIOutliner, UIPoints, UIPoints2, UIPoints3, UIBoolean };\r\n\t\t\r\n});"]}