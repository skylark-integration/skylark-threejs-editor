/**
 * skylark-threejs-editor - A version of threejs-editor that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-threejs-editor/
 * @license MIT
 */
define(["skylark-threejs","skylark-threejs-ex/loaders/AMFLoader","skylark-threejs-ex/loaders/ColladaLoader","skylark-threejs-ex/loaders/DRACOLoader","skylark-threejs-ex/loaders/FBXLoader","skylark-threejs-ex/loaders/GLTFLoader","skylark-threejs-ex/loaders/KMZLoader","skylark-threejs-ex/loaders/MD2Loader","skylark-threejs-ex/loaders/MTLLoader","skylark-threejs-ex/loaders/OBJLoader","skylark-threejs-ex/loaders/PLYLoader","skylark-threejs-ex/loaders/STLLoader","skylark-threejs-ex/loaders/SVGLoader","skylark-threejs-ex/loaders/TDSLoader","skylark-threejs-ex/loaders/VTKLoader","skylark-threejs-ex/loaders/VRMLLoader","./commands/AddObjectCommand","./commands/SetSceneCommand","./LoaderUtils"],function(e,a,r,t,n,s,o,d,i,l,c,u,f,v,m,w,p,L,g){"use strict";return function(x){var y=this;function h(a){switch(void 0===a.metadata&&(a.metadata={type:"Geometry"}),void 0===a.metadata.type&&(a.metadata.type="Geometry"),void 0!==a.metadata.formatVersion&&(a.metadata.version=a.metadata.formatVersion),a.metadata.type.toLowerCase()){case"buffergeometry":var r=(n=new e.BufferGeometryLoader).parse(a),t=new e.Mesh(r);x.execute(new p(x,t));break;case"geometry":console.error('Loader: "Geometry" is no longer supported.');break;case"object":var n;(n=new e.ObjectLoader).setResourcePath(y.texturePath),n.parse(a,function(e){e.isScene?x.execute(new L(x,e)):x.execute(new p(x,e))});break;case"app":x.fromJSON(a)}}this.texturePath="",this.loadItemList=function(e){g.getFilesFromItemList(e,function(e,a){y.loadFiles(e,a)})},this.loadFiles=function(a,r){if(a.length>0){r=r||g.createFilesMap(a);var t=new e.LoadingManager;t.setURLModifier(function(e){var a=r[e];return a?(console.log("Loading",e),URL.createObjectURL(a)):e});for(var n=0;n<a.length;n++)y.loadFile(a[n],t)}},this.loadFile=function(g,y){var k=g.name,A=k.split(".").pop().toLowerCase(),b=new FileReader;switch(b.addEventListener("progress",function(e){var a="("+Math.floor(e.total/1e3).format()+" KB)",r=Math.floor(e.loaded/e.total*100)+"%";console.log("Loading",k,a,r)}),A){case"3ds":b.addEventListener("load",function(e){var a=(new v).parse(e.target.result);x.execute(new p(x,a))},!1),b.readAsArrayBuffer(g);break;case"amf":b.addEventListener("load",function(e){var r=(new a).parse(e.target.result);x.execute(new p(x,r))},!1),b.readAsArrayBuffer(g);break;case"dae":b.addEventListener("load",function(e){var a=e.target.result,t=new r(y).parse(a);t.scene.name=k,x.addAnimation(t.scene,t.animations),x.execute(new p(x,t.scene))},!1),b.readAsText(g);break;case"drc":b.addEventListener("load",function(a){var r=a.target.result,n=new t;n.setDecoderPath("../examples/js/libs/draco/"),n.decodeDracoFile(r,function(a){var r=new e.MeshStandardMaterial,t=new e.Mesh(a,r);t.name=k,x.execute(new p(x,t))})},!1),b.readAsArrayBuffer(g);break;case"fbx":b.addEventListener("load",function(e){var a=e.target.result,r=new n(y).parse(a);x.addAnimation(r,r.animations),x.execute(new p(x,r))},!1),b.readAsArrayBuffer(g);break;case"glb":b.addEventListener("load",function(e){var a=e.target.result,r=new t;r.setDecoderPath("../examples/js/libs/draco/gltf/");var n=new s;n.setDRACOLoader(r),n.parse(a,"",function(e){var a=e.scene;a.name=k,x.addAnimation(a,e.animations),x.execute(new p(x,a))})},!1),b.readAsArrayBuffer(g);break;case"gltf":b.addEventListener("load",function(a){var r,n=a.target.result;if(function(a){var r;if("string"==typeof a)r=a;else{var t=e.undefined.decodeText(new Uint8Array(a,0,4));if("glTF"===t){var n=new DataView(a).getUint32(4,!0);return n<2}r=e.undefined.decodeText(new Uint8Array(a))}var s=JSON.parse(r);return void 0!=s.asset&&s.asset.version[0]<2}(n))alert("Import of glTF asset not possible. Only versions >= 2.0 are supported. Please try to upgrade the file to glTF 2.0 using glTF-Pipeline.");else{var o=new t;o.setDecoderPath("../examples/js/libs/draco/gltf/"),(r=new s(y)).setDRACOLoader(o)}r.parse(n,"",function(e){var a=e.scene;a.name=k,x.addAnimation(a,e.animations),x.execute(new p(x,a))})},!1),b.readAsArrayBuffer(g);break;case"js":case"json":case"3geo":case"3mat":case"3obj":case"3scn":b.addEventListener("load",function(e){var a,r=e.target.result;if(-1!==r.indexOf("postMessage")){var t=new Blob([r],{type:"text/javascript"}),n=URL.createObjectURL(t),s=new Worker(n);return s.onmessage=function(e){e.data.metadata={version:2},h(e.data)},void s.postMessage(Date.now())}try{a=JSON.parse(r)}catch(e){return void alert(e)}h(a)},!1),b.readAsText(g);break;case"kmz":b.addEventListener("load",function(e){var a=(new o).parse(e.target.result);a.scene.name=k,x.execute(new p(x,a.scene))},!1),b.readAsArrayBuffer(g);break;case"md2":b.addEventListener("load",function(a){var r=a.target.result,t=(new d).parse(r),n=new e.MeshStandardMaterial({morphTargets:!0,morphNormals:!0}),s=new e.Mesh(t,n);s.mixer=new e.AnimationMixer(s),s.name=k,x.addAnimation(s,t.animations),x.execute(new p(x,s))},!1),b.readAsArrayBuffer(g);break;case"obj":b.addEventListener("load",function(e){var a=e.target.result,r=(new l).parse(a);r.name=k,x.execute(new p(x,r))},!1),b.readAsText(g);break;case"ply":b.addEventListener("load",function(a){var r=a.target.result,t=(new c).parse(r);t.sourceType="ply",t.sourceFile=g.name;var n=new e.MeshStandardMaterial,s=new e.Mesh(t,n);s.name=k,x.execute(new p(x,s))},!1),b.readAsArrayBuffer(g);break;case"stl":b.addEventListener("load",function(a){var r=a.target.result,t=(new u).parse(r);t.sourceType="stl",t.sourceFile=g.name;var n=new e.MeshStandardMaterial,s=new e.Mesh(t,n);s.name=k,x.execute(new p(x,s))},!1),void 0!==b.readAsBinaryString?b.readAsBinaryString(g):b.readAsArrayBuffer(g);break;case"svg":b.addEventListener("load",function(a){var r=a.target.result,t=(new f).parse(r).paths,n=new e.Group;n.scale.multiplyScalar(.1),n.scale.y*=-1;for(var s=0;s<t.length;s++)for(var o=t[s],d=new e.MeshBasicMaterial({color:o.color,depthWrite:!1}),i=o.toShapes(!0),l=0;l<i.length;l++){var c=i[l],u=new e.ShapeBufferGeometry(c),v=new e.Mesh(u,d);n.add(v)}x.execute(new p(x,n))},!1),b.readAsText(g);break;case"vtk":b.addEventListener("load",function(a){var r=a.target.result,t=(new m).parse(r);t.sourceType="vtk",t.sourceFile=g.name;var n=new e.MeshStandardMaterial,s=new e.Mesh(t,n);s.name=k,x.execute(new p(x,s))},!1),b.readAsText(g);break;case"wrl":b.addEventListener("load",function(e){var a=e.target.result,r=(new w).parse(a);x.execute(new L(x,r))},!1),b.readAsText(g);break;case"zip":b.addEventListener("load",function(a){!function(a){var r=new JSZip(a);if(r.files["model.obj"]&&r.files["materials.mtl"]){var t=(new i).parse(r.file("materials.mtl").asText()),o=(new l).setMaterials(t).parse(r.file("model.obj").asText());x.execute(new p(x,o))}r.filter(function(a,t){var o=new e.LoadingManager;o.setURLModifier(function(e){var a=r.files[e];if(a){console.log("Loading",e);var t=new Blob([a.asArrayBuffer()],{type:"application/octet-stream"});return URL.createObjectURL(t)}return e});var d=t.name.split(".").pop().toLowerCase();switch(d){case"fbx":var i=new n(o),l=i.parse(t.asArrayBuffer());x.execute(new p(x,l));break;case"glb":var i=new s;i.parse(t.asArrayBuffer(),"",function(e){var a=e.scene;x.addAnimation(a,e.animations),x.execute(new p(x,a))});break;case"gltf":var i=new s(o);i.parse(t.asText(),"",function(e){var a=e.scene;x.addAnimation(a,e.animations),x.execute(new p(x,a))})}})}(a.target.result)},!1),b.readAsBinaryString(g)}}}});
//# sourceMappingURL=sourcemaps/Loader.js.map
